{% extends "layout.html" %}

{% macro log_list(logs) -%}
    <p>
        {% if logs %}
            <table class="table table-striped">
                <tr><th>Zeit</th><th>Benutzer</th><th>Nachricht</th></tr>
               {% for entry in logs %}
                    <td class="shrink">{{ entry.timestamp|datetime }}</td>
                    <td class="shrink"><a href="{{ url_for(".user_show", user_id=entry.author.id) }}">{{ entry.author.name }}</a></td>
                    <td class="grow">{{ entry.message }}</td>
                {% endfor %}
            </table>
        {% else %}
        <div class="alert alert-info">
            Keine Logeintr√§ge vorhanden.
        </div>
        {% endif %}
    </p>
{%- endmacro %}

{% block content %}
    <ul class="breadcrumb">
        <li>
            <a href="{{ url_for('dormitories.overview') }}">Wohnheime</a>
        </li>
        <li>
            <a href="{{ url_for('dormitories.dormitory_levels', dormitory_id=room.dormitory.id) }}">{{ room.dormitory.short_name }}</a>
        </li>
        <li>
            <a href="{{url_for('.dormitory_level_rooms', dormitory_id=room.dormitory_id, level=room.level)}}">
                Etage {{ room.level|level_number }}
            </a>
        </li>
        <li class="active">Zimmer {{ room.number }}</li>
    </ul>
    <ul class="unstyled">
        <li>Wohnheim: {{ room.dormitory.street }} {{ room.dormitory.number
                }}</li>
        <li>Nummer: {{ room.number }}</li>
        <li>Etage: {{ room.level }}</li>
        <li>Bewohnbar: {{ room.inhabitable }}</li>
    </ul>

    {% if room.inhabitable %}
        {% if room.users|length == 0 %}
            <h4>In diesem Zimmer wohnt niemand, oder derjenige bekommt von uns kein Netz.</h4>
        {% else %}
            <h4>Bewohner dieses Zimmers:</h4>
            <ul class="unstyled">
                {% for user in room.users %}
                    <li><a href="{{ url_for('user.user_show', user_id=user.id) }}">{{ user.name }}</a> </li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endif %}

    <hr/>

    <div class="row">
        <div class="span6">
            {{ log_list(room_logs) }}
        </div>

        <div class="span6">
            <form method="POST" action="" class="form-horizontal">
                <p>
                {{ form.hidden_tag() }}
                {% for field in form %}
                    {% if field.type not in ["HiddenField", "CSRFTokenField"] %}
                        {{ field(placeholder='Nachricht', class='span6 form-control') }}
                    {% endif %}
                {% endfor %}
                </p>
                <button type="submit" class="btn btn-default btn-primary">Absenden</button>
            </form>
        </div>
    </div>
{% endblock %}
