{#
 Copyright (c) 2014 The Pycroft Authors. See the AUTHORS file.
 This file is part of the Pycroft project and licensed under the terms of
 the Apache License, Version 2.0. See the LICENSE file for details.
#}
{% extends "layout.html" %}
{% set page_title = "Journaleintrag bearbeiten" %}

{% block content %}
    <a href="{{ url_for('.journals') }}">Zurück zur Übersicht</a><br />

    <form class="form form-horizontal" method="post" action="">
        {{ form.hidden_tag() }}
        {{ form.linked_financeaccount }}

        <table class="table table-striped">
            <tr>
                <td>Gegenkonto</td>
                <td>{{ form.search }}</td>
            </tr>
            <tr>
                <td>Datum</td>
                <td>{{ entry.valid_date|date }}</td>
            </tr>
            <tr>
                <td>Betrag</td>
                <td>{{ entry.amount|money }}</td>
            </tr>
            <tr>
                <td>Nachricht</td>
                <td>{{ entry.message }}</td>
            </tr>
            <tr>
                <td>Fremdkonto</td>
                <td>{{ entry.other_account }}</td>
            </tr>
            <tr>
                <td>Fremdbank</td>
                <td>{{ entry.other_bank }}</td>
            </tr>
            <tr>
                <td>Fremdperson</td>
                <td>{{ entry.other_person }}</td>
            </tr>
        </table>
    <button class="btn btn-primary" type="submit">Abschicken</button>
    </form>
{% endblock %}

{% block page_script %}
    <script src="{{ url_for("static", filename="bootstrap-typeahead/bootstrap3-typeahead.min.js") }}" type="text/javascript"></script>
    <script type="text/javascript">
        $('#search').typeahead({
            source: function (query, process) {
                return $.getJSON(
                    '{{ url_for('.json_search_accounts', search_str='') }}'+query,
                    function (data) {
                        window.keymap = {};
                        var result = [];
                        $.each(data.result, function(index, item) {
                            window.keymap[item.name] = item.id;
                            result.push(item.name);
                        });
                        return process(result);
                    });
            },
            updater: function (item) {
                $('#linked_financeaccount').val(window.keymap[item]);
                return item;
            },
            minLength: 2
        });
    </script>
{% endblock %}
