{% extends "layout.html" %}

{% set page_title = "Konto: " + name %}

{% set inverted = false %}

{% macro render_column_headings() %}
    <th>Erstellt am</th>
    <th>GÃ¼ltig ab</th>
    <th>Beschreibung</th>
    <th>Wert</th>
{% endmacro %}

{% macro render_split(split, cell_class="", absolute=false) %}
    {% if split %}
        <td class="{{ cell_class }}">{{ split.transaction.transaction_date|datetime }}</td>
        <td class="{{ cell_class }}">{{ split.transaction.valid_date|date }}</td>
        <td class="{{ cell_class }}"><a href="{{ url_for(".show_transaction", transaction_id=split.transaction_id) }}">{{ split.transaction.description }}</a></td>
        <td class="{{ cell_class }}">{{ split.amount|abs|money if absolute else split.amount|money }}</td>
    {% endif %}
{% endmacro %}

{% block page_header %}
    <div class="btn-group pull-right">
        <button id="account-form-button" type="button" class="btn btn-default">Kontenform</button>
        <button id="report-form-button" type="button" class="btn btn-default">Staffelform</button>
    </div>
    {{ super() }}
{% endblock %}

{% block content %}
    <table id="report-form" class="table table-striped">
        <thead>
            <tr>
                {{ render_column_headings() }}
            </tr>
        </thead>
        <tbody>
        {%- for split in splits %}
            <tr class="{{ "success" if (split.amount > 0 and not inverted) or (split.amount <= 0 and inverted) else "danger" }}">
                {{ render_split(split) }}
            </tr>
        {%- endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3">Saldo</td>
                <td>{{ balance|money }}</td>
            </tr>
        </tfoot>
    </table>
    <table id="account-form" class="table table-bordered">
        <thead>
            <tr>
                <th colspan="4" style="width: 50%;" class="text-center">Soll</th>
                <th colspan="4" style="width: 50%;" class="text-center">Haben</th>
            </tr>
            <tr>
                {% for ignore in range(2) %}
                    {{ render_column_headings() }}
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for debit_split, credit_split in typed_splits %}
                <tr>
                    {{ render_split(debit_split, "danger" if inverted else "success", true) }}
                    {{ render_split(credit_split, "success" if inverted else "danger", true) }}
                </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="7" class="text-right">Saldo</td>
                <td colspan="1">{{ balance|money }}</td>
            </tr>
        </tfoot>
    </table>
{% endblock %}

{% block page_script  %}
    <script type="application/javascript">
        create_toggle_handler = (function(activeButton, passiveButton, visibleElement, hiddenElement) {
            return (function() {
                visibleElement.addClass('hidden');
                hiddenElement.removeClass('hidden');
                activeButton.removeClass('active');
                passiveButton.addClass('active');
            });
        });
        accountFormButton = $('#account-form-button');
        reportFormButton = $('#report-form-button');
        accountFormElement = $('#account-form');
        reportFormElement = $('#report-form');
        accountFormButton.click(create_toggle_handler(reportFormButton, accountFormButton, reportFormElement, accountFormElement)).trigger('click');
        reportFormButton.click(create_toggle_handler(accountFormButton, reportFormButton, accountFormElement, reportFormElement));
    </script>
{% endblock %}
